@page "/application"
@using BCI.Extensions.DDD.ApplicationService;
@using BCI.Extensions.Core.Json;
@using AirCC.Portal.AppService.ApplicationDtos;
@inject HttpClient Http
@inject IJsonSerializer json
@using AirCC.PortalUI.Shared.Table

@if (result?.DataList == null)
{
    <p><em>Loading applications...</em></p>
}
else
{

    <TableTemplate TableTitle="Applications" Items="result.DataList" Context="item" TotalCount=350 TotalPages=35 PageSize=" 10"
                   PageIndex=@result.CurrentIndex PageItemClickEventCallback="@PageItemClicked">
        <TableHeaderContent>
            <TableHeaderCell>Name</TableHeaderCell>
            <TableHeaderCell>ClientSecret</TableHeaderCell>
        </TableHeaderContent>
        <RowTemplate>
            <TableRowCell>@item.Name</TableRowCell>
            <TableRowCell>@item.ClientSecret</TableRowCell>
        </RowTemplate>
    </TableTemplate>


    <Row>
        <Column ColumnSize="ColumnSize.IsFull.OnDesktop.IsFull.OnWidescreen">
            <Card Margin="Margin.Is4.FromBottom">
                <CardHeader>
                    <CardTitle>Applications</CardTitle>
                </CardHeader>
                <CardBody>
                    <Table>
                        <TableHeader>
                            <TableRow>
                                <TableHeaderCell>Name</TableHeaderCell>
                                <TableHeaderCell>ClientSecret</TableHeaderCell>
                            </TableRow>
                        </TableHeader>
                        <TableBody>
                            @foreach (var item in result.DataList)
                            {
                                <TableRow>
                                    <TableRowCell>@item.Name</TableRowCell>
                                    <TableRowCell>@item.ClientSecret</TableRowCell>
                                </TableRow>
                            }

                        </TableBody>
                    </Table>
                    <Paginator PageIndex=@result.CurrentIndex TotalCount=350 TotalPages=35 PageSize=" 10"
                               PageItemClickEventCallback="@PageItemClicked"></Paginator>
                </CardBody>
            </Card>
        </Column>
    </Row>
}

@code {
    private PagedResultDto<ApplicationListOutput> result;

    protected override async Task OnInitializedAsync()
    {
        var original = await Http.GetAsync("api/app/pagedList/aircc/1");
        result = json.Deserialize<PagedResultDto<ApplicationListOutput>>(await original.Content.ReadAsStringAsync());
    }

    public void PageItemClicked(string pageIndex)
    {
        //https://docs.microsoft.com/en-us/aspnet/core/blazor/components/templated-components?view=aspnetcore-5.0
        result.CurrentIndex = int.Parse(pageIndex);
        //return Task.CompletedTask;
    }



}
